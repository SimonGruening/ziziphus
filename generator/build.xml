<?xml version="1.0" encoding="UTF-8"?>
<project name="Ziziphus xsd2xforms Generator" id="ziziphus" default="generate-forms" basedir=".">


    <property name="generator.dir" value="${basedir}"/>

    <xmlproperty file="../build.properties.xml" semanticAttributes="true" keepRoot="false"/>
    <property name="target.dir" value="${basedir}/${build.dir}"/>
    <property name="target.schema.dir" value="${target.dir}/xsd"/>
    <!--<property name="target.forms.dir" value="${target.dir}/forms"/>-->
    <!--<property name="target.resources.dir" value="${target.dir}/resources" description="directory holding dynamic resources used by the generator"/>-->

    <!--<property name="resource.dir" value="${basedir}/resources"/>-->
    <property name="schema.dir" value="${basedir}/xsd"/>
    <property name="deploy.schema.dir" value="${basedir}/../resources/xsd"/>
    <property name="form.dir" value="${basedir}/../forms"/>

    <property name="xsl.dir" value="${basedir}/xsl"/>
    <property name="xsl.xsd.dir" value="${xsl.dir}/inlineXSD"/>
    
    
    <property name="vra.bf.schema.name" value="vra-bf.xsd"/>
    <property name="vra.types.schema.name" value="vra-types.xsd"/>
    <property name="vra.types.schema.path" value="${deploy.schema.dir}/${vra.types.schema.name}"/>

    <!-- **************************************** HOUSEKEEPING **************************************** -->
    <!-- **************************************** HOUSEKEEPING **************************************** -->
    <!-- **************************************** HOUSEKEEPING **************************************** -->
    <target name="clean" description="clean up everything">
        <delete dir="${target.dir}"/>
    </target>

    <target name="testMerge">
        <xslt style="${xsl.dir}/mergeData.xsl"
                in="template.xml"
                out="${target.dir}/merged.xml"
                force="yes">
            <classpath refid="transform.class.path"/>
            <param name="incomingData" expression="../data.xml"/>
        </xslt>
    </target>

    <target name="prepare">
        <echo>Create generator resource: single file holding all instance data structures</echo>
        <!-- generate an XML instance of vra-bf.xsd -->
        <xslt style="${xsl.dir}/xf/vra2xf_01_Instance_Generator.xsl"
              in="${deploy.schema.dir}/${vra.bf.schema.name}"
              out="${target.dir}/01_VRA_Instance.xml">
            <classpath refid="transform.class.path"/>
            <param name="debug" expression="false"/>
        </xslt>

        <echo>Create generator resource: single file containing all binding information</echo>
        <!-- generate XForms Bindings of vra-bf.xsd -->
        <xslt style="${xsl.dir}/xf/vra2xf_02_Bind_Generator.xsl"
              in="${deploy.schema.dir}/${vra.bf.schema.name}"
              out="${target.dir}/02_XF_Binds.xml">
            <classpath refid="transform.class.path"/>
            <param name="debug" expression="true"/>
        </xslt>
    </target>

    <target name="generate-forms" depends="prepare" description="generate XForms">
        <echo>Generate first chunk of VRA forms</echo>
        <!-- VRA Section agentSection -->
        <antcall target="generate-subform">
            <param name="subformName" value="AgentSet"/>
        </antcall>

        <!-- VRA Section culturalContextSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="CulturalContextSet"/>
        </antcall>

        <!-- VRA Section dateSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="DateSet"/>
        </antcall>

        <!-- VRA Section descriptionSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="DescriptionSet"/>
        </antcall>

        <!-- VRA Section descriptionSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="InscriptionSet"/>
        </antcall>

        <!-- VRA Section inscriptionSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="InscriptionSet"/>
        </antcall>

        <!-- VRA Section locationSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="LocationSet"/>
        </antcall>

        <!-- VRA Section materialSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="MaterialSet"/>
        </antcall>

        <!-- VRA Section measurementsSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="MeasurementsSet"/>
        </antcall>

        <!-- VRA Section relationSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="RelationSet"/>
        </antcall>

        <!-- VRA Section rightsSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="RightsSet"/>
        </antcall>
        <!-- VRA Section sourceSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="SourceSet"/>
        </antcall>

        <!-- VRA Section sourceSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="StateEditionSet"/>
        </antcall>

        <!-- VRA Section stylePeriodSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="StylePeriodSet"/>
        </antcall>

        <!-- VRA Section stylePeriodSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="SubjectSet"/>
        </antcall>

        <!-- VRA Section techniqueSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="TechniqueSet"/>
        </antcall>

        <!-- VRA Section textrefSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="TextrefSet"/>
        </antcall>

        <!-- VRA Section titleSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="TitleSet"/>
        </antcall>

        <!-- VRA Section worktypeSet -->
        <antcall target="generate-subform">
            <param name="subformName" value="WorktypeSet"/>
        </antcall>

    </target>

    <target name="generate-Agentset-form" depends="prepare" description="generate the AgentSet form">
        <antcall target="generate-subform">
            <param name="subformName" value="AgentSet"/>
        </antcall>
    </target>
    <target name="generate-CulturalContextSet-form" depends="prepare" description="generate the CulturalContextSet form">
        <antcall target="generate-subform">
            <param name="subformName" value="CulturalContextSet"/>
        </antcall>
    </target>
    <target name="generate-DateSet-form" depends="prepare" description="generate the DateSet form">
        <antcall target="generate-subform">
            <param name="subformName" value="DateSet"/>
        </antcall>
    </target>
    <target name="generate-LocationSet-form" depends="prepare" description="generate the LocationSet form">
        <antcall target="generate-subform">
            <param name="subformName" value="LocationSet"/>
        </antcall>
    </target>
    <target name="generate-MeasurementsSet-form" depends="prepare" description="generate the MeasurementsSet form">
        <antcall target="generate-subform">
            <param name="subformName" value="MeasurementsSet"/>
        </antcall>
    </target>
    <target name="generate-RelationSet-form" depends="prepare" description="generate the RelationSet form">
        <antcall target="generate-subform">
            <param name="subformName" value="RelationSet"/>
        </antcall>
    </target>
    <target name="generate-StateEditionSet-form" depends="prepare" description="generate the StateEditionSet form">
        <antcall target="generate-subform">
            <param name="subformName" value="StateEditionSet"/>
        </antcall>
    </target>

    <target name="generate-subform">
        <echo>generate-subform ${subformName}</echo>
        <xslt style="${xsl.dir}/xf/vra2xf_04_XF_Section_Subform_Generator.xsl"
                in="${target.dir}/02_XF_Binds.xml"
                out="${target.dir}/${subformName}.xhtml"
                force="true">
            <classpath refid="transform.class.path"/>
            <param name="debug" expression="true"/>
            <param name="path_2_vra_types_schema" expression="${vra.types.schema.path}"/>
            <param name="path_2_xf_instance" expression="${target.dir}/01_VRA_Instance.xml"/>
            <param name="vraSection" expression="${subformName}"/>
        </xslt>

        <!--<copy file="${target.forms.dir}/data/${instanceName}.xml" tofile="${form.dir}/data/${instanceName}.xml"/>-->
        <copy file="${target.dir}/${subformName}.xhtml" tofile="${form.dir}/${subformName}.xhtml"/>

    </target>

</project>